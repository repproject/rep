#LV3
SELECT COUNT(*) FROM KMIG_KB_REGN WHERE LV_CD = '2'; #229
SELECT COUNT(*) FROM KRED_LEGL_REGN WHERE LV_CD = '2'; #261
SELECT * FROM KMIG_KB_REGN WHERE LV_CD = '2'; #4724
SELECT * FROM KRED_LEGL_REGN WHERE LV_CD = '2'; #5039
;
#LV2 INSERT 229
#INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
SELECT KR.KB_REGN_CD, LR.LEGL_REGN_CD, '2', 1000000001, NOW(), 1000000001,NOW()
FROM KRED_LEGL_REGN LR
INNER JOIN KMIG_KB_REGN KR
ON LR.LEGL_REGN_NM = KR.KB_REGN_NM
AND KR.LV_CD = '2'
INNER JOIN KMIG_KB_NV_REGN_KEY_MAPP KNRKM
ON KNRKM.KB_REGN_CD = KR.UP_KB_REGN_CD
AND KNRKM.LEGL_REGN_CD = LR.UP_LEGL_REGN_CD
AND KNRKM.LV_CD = '1'
WHERE LR.LV_CD = '2'
;
#LV2 레벨 안맞는것들(수원시 영통구 ...) 별도 MIG
#INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
SELECT 
(SELECT KR.KB_REGN_CD FROM KMIG_KB_REGN KR WHERE KR.KB_REGN_NM = (SELECT LRS.LEGL_REGN_NM FROM KRED_LEGL_REGN LRS WHERE LRS.LEGL_REGN_CD = CONCAT(SUBSTR(LR.LEGL_REGN_CD,1,4),'000000')))
,LR.LEGL_REGN_CD, '2', 1000000001, NOW(), 1000000001,NOW()
FROM KRED_LEGL_REGN LR
WHERE LEGL_REGN_CD NOT IN (
	SELECT LR.LEGL_REGN_CD
	FROM KRED_LEGL_REGN LR
	INNER JOIN KMIG_KB_REGN KR
	ON LR.LEGL_REGN_NM = KR.KB_REGN_NM
	AND KR.LV_CD = '2'
	INNER JOIN KMIG_KB_NV_REGN_KEY_MAPP KNRKM
	ON KNRKM.KB_REGN_CD = KR.UP_KB_REGN_CD
	AND KNRKM.LEGL_REGN_CD = LR.UP_LEGL_REGN_CD
	AND KNRKM.LV_CD = '1'
	WHERE LR.LV_CD = '2'
)    
AND LR.LV_CD = '2'
;

#LV3
SELECT COUNT(*) FROM KMIG_KB_REGN WHERE LV_CD = '3'; #4724
SELECT COUNT(*) FROM KRED_LEGL_REGN WHERE LV_CD = '3'; #5039
SELECT * FROM KMIG_KB_REGN WHERE LV_CD = '3'; #4724
SELECT * FROM KRED_LEGL_REGN WHERE LV_CD = '3'; #5039
# LV3-1 같은 천안시의 중복 2건 별도 MIG
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP SELECT '101143', '4413111700', '3', 1000000001, NOW(), 1000000001,NOW(); #4413111700 천안시 동남구 쌍용동 101143
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP SELECT '101128', '4413310700', '3', 1000000001, NOW(), 1000000001,NOW(); #4413310700 천안시 서북구 창용동 101128
# LV3-2 정상 MIG
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
SELECT KR.KB_REGN_CD, LR.LEGL_REGN_CD, '3', 1000000001, NOW(), 1000000001,NOW()
#SELECT COUNT(*) #4562 
FROM KRED_LEGL_REGN LR
INNER JOIN KMIG_KB_REGN KR
ON LR.LEGL_REGN_NM = KR.KB_REGN_NM
AND KR.LV_CD = '3'
INNER JOIN KMIG_KB_NV_REGN_KEY_MAPP KNRKM
ON KNRKM.KB_REGN_CD = KR.UP_KB_REGN_CD
AND KNRKM.LEGL_REGN_CD = LR.UP_LEGL_REGN_CD
WHERE LR.LV_CD = '3'
AND KR.KB_REGN_CD NOT IN ('101128','101143') #4562 천안시 동남구, 서북구 쌍용동 제외
;
# LV3-3 KB누락건
#KB는 4724 - 4564 = 160 최종2개 이도1동 이도2동은 이도동으로 매핑해서 관리 버리는 코드 2개
SELECT KR1.KB_REGN_CD, KR1.KB_REGN_NM, KR2.KB_REGN_CD, KR2.KB_REGN_NM, KR3.KB_REGN_CD, KR3.KB_REGN_NM
FROM KMIG_KB_REGN KR3
INNER JOIN KMIG_KB_REGN KR2
ON KR3.UP_KB_REGN_CD = KR2.KB_REGN_CD
INNER JOIN KMIG_KB_REGN KR1
ON KR2.UP_KB_REGN_CD = KR1.KB_REGN_CD
WHERE KR3.KB_REGN_CD NOT IN (
	SELECT KB_REGN_CD FROM KMIG_KB_NV_REGN_KEY_MAPP
)
AND KR3.LV_CD = '3'
;
# LV3-4 KB누락건
#KB는 5039 - 4564 = 475
SELECT *
FROM KRED_LEGL_REGN LR
WHERE LEGL_REGN_CD NOT IN (
	SELECT LEGL_REGN_CD FROM KMIG_KB_NV_REGN_KEY_MAPP
)
AND LR.LV_CD = '3'
;
# LV3-5 N가MIG 421개
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
SELECT KR.KB_REGN_CD, LR.LEGL_REGN_CD, '3', 1000000001, NOW(), 1000000001,NOW()
#SELECT COUNT(*) #4562 
FROM KRED_LEGL_REGN LR
INNER JOIN KMIG_KB_REGN KR
ON REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(LR.LEGL_REGN_NM,'가',''),'1',''),'2',''),'3',''),'4',''),'5',''),'6',''),'7',''),'8',''),'9',''),'0',''),'동','') = REPLACE(KR.KB_REGN_NM,'동','')
AND KR.LV_CD = '3'
AND LEGL_REGN_CD NOT IN (
	SELECT LEGL_REGN_CD FROM KMIG_KB_NV_REGN_KEY_MAPP
)
AND LR.LV_CD = '3'
INNER JOIN KMIG_KB_NV_REGN_KEY_MAPP KNRKM
ON KNRKM.KB_REGN_CD = KR.UP_KB_REGN_CD
AND KNRKM.LEGL_REGN_CD = LR.UP_LEGL_REGN_CD
WHERE LR.LV_CD = '3'
AND KR.KB_REGN_CD NOT IN ('101128','101143') #4562 천안시 동남구, 서북구 쌍용동 제외
AND LR.LEGL_REGN_CD NOT IN (
	SELECT LEGL_REGN_CD FROM KMIG_KB_NV_REGN_KEY_MAPP
)
;
# LV3-6 KB누락건
#KB는 34건
SELECT KR1.KB_REGN_CD, KR1.KB_REGN_NM, KR2.KB_REGN_CD, KR2.KB_REGN_NM, KR3.KB_REGN_CD, KR3.KB_REGN_NM
FROM KMIG_KB_REGN KR3
INNER JOIN KMIG_KB_REGN KR2
ON KR3.UP_KB_REGN_CD = KR2.KB_REGN_CD
INNER JOIN KMIG_KB_REGN KR1
ON KR2.UP_KB_REGN_CD = KR1.KB_REGN_CD
WHERE KR3.KB_REGN_CD NOT IN (
	SELECT KB_REGN_CD FROM KMIG_KB_NV_REGN_KEY_MAPP
)
AND KR3.LV_CD = '3'
;
# LV3-7 KB누락건
#KB는 5039 - 4564 = 475 / 475 - 425 = 54 (O)
SELECT *
FROM KRED_LEGL_REGN LR
WHERE LEGL_REGN_CD NOT IN (
	SELECT LEGL_REGN_CD FROM KMIG_KB_NV_REGN_KEY_MAPP
)
AND LR.LV_CD = '3'
;
# LV3-8 제주도 이도동 보정건
#제주도 제주시 이도1동 이도2동 KB는 이도동에 단지가 매핑되어 있음.
#UPDATE
SELECT * FROM 
KMIG_KB_NV_REGN_KEY_MAPP
/*SET KB_REGN_CD = '160420'
  , CHG_DTM = NOW()*/
WHERE LEGL_REGN_CD IN ('5011010300','5011010400')
;
UPDATE
#SELECT * FROM 
KMIG_KB_CMPX
SET KB_REGN_CD = '160420'
  , CHG_DTM  = NOW()
WHERE KB_REGN_CD IN ('160434','160433')
;



# LV3-9 KB기준 법정동 매핑 1건 MIG
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
SELECT '21239', '4113313200', '3', 1000000001, NOW(), 1000000001,NOW()
;
# LV3-10 수작업 MIG 50개
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '20106', '4182034500', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '20901', '4136011200', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '22310', '4146125300', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '22321', '4146125600', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '121583', '4812511900', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '121587', '4812512300', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '121590', '4812512700', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '1215A2', '4812514700', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '1215A2', '4812514800', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '1215A2', '4812514900', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '1215B2', '4812515900', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '121548', '4812311900', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '121558', '4812312500', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '121536', '4812312700', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '121507', '4812313300', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '121523', '4812111500', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '121544', '4812112600', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '1215F7', '4812910400', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '1215I6', '4812910500', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '1215H4', '4812912600', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '1215D0', '4812915700', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '131611', '4790043000', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '151210', '4511111300', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '151210', '4511111400', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '151210', '4511111500', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '151210', '4511111600', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160405', '5011012800', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160405', '5011012700', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160406', '5011013100', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160406', '5011013000', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160409', '5011010600', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160409', '5011010500', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160410', '5011011500', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160410', '5011011400', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160410', '5011011300', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160411', '5011011800', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160411', '5011011700', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160415', '5011012100', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160415', '5011012000', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160415', '5011011900', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160416', '5011012400', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160416', '5011012300', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160418', '5011011000', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160418', '5011010900', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160418', '5011010800', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160421', '5011012600', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160421', '5011012500', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160422', '5011010200', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160422', '5011010100', '3', 1000000001, NOW(), 1000000001,NOW();
INSERT INTO KMIG_KB_NV_REGN_KEY_MAPP
 SELECT '160424', '5011011200', '3', 1000000001, NOW(), 1000000001,NOW();
 
 ;
#엑셀에서 씌이발 앞에 0을 없애 버려서 보정
UPDATE
KMIG_KB_NV_REGN_KEY_MAPP
SET KB_REGN_CD = CONCAT('0',KB_REGN_CD)
WHERE LENGTH(KB_REGN_CD) = 5
 ;
    
    UPDATE
#SELECT * FROM 
KMIG_KB_CMPX
SET KB_REGN_CD = '160420'
  , CHG_DTM  = NOW()
WHERE KB_REGN_CD IN ('160434','160433')
;
UPDATE 
#SELECT * FROM 
KMIG_KB_NV_REGN_KEY_MAPP
SET LEGL_REGN_CD = '4136011200'
#WHERE LEGL_REGN_CD IN ('4136011000','4136010900')
WHERE KB_REGN_CD IN ('020903','020913')

;


;

    4136011200

