/* 특정 기간에 가장 많이 오른 단지 */
SELECT KR1.KB_REGN_NM
     , KR2.KB_REGN_NM
     , KR3.KB_REGN_NM
     , KC.CMPX_IDF_NM
     , CT.HOUSE_TYP_NM
	 , T_DIFF.RATE
     , T_DIFF.DIFF
     , T_DIFF.INVEST
     , T_DIFF.INVEST_RATE
FROM KMIG_KB_CMPX_TYP CT
	, KMIG_KB_CMPX KC 
    , KMIG_KB_REGN KR3
    , KMIG_KB_REGN KR2
    , KMIG_KB_REGN KR1
    , (
		SELECT CMPX_IDF_ID
			 , HOUSE_TYP_SEQ
			 , STD_YYMM
			 #, GNRL_AVG_PRC
			 #, (SELECT GNRL_AVG_PRC FROM KMIG_KB_CMPX_TYP_MON_PRC B WHERE A.CMPX_IDF_ID = B.CMPX_IDF_ID AND A.HOUSE_TYP_SEQ = B.HOUSE_TYP_SEQ AND A.STD_YYMM - 400 = B.STD_YYMM) PAST_GNRL_AVG_PRC
			 ,GNRL_AVG_PRC/(SELECT GNRL_AVG_PRC FROM KMIG_KB_CMPX_TYP_MON_PRC B WHERE A.CMPX_IDF_ID = B.CMPX_IDF_ID AND A.HOUSE_TYP_SEQ = B.HOUSE_TYP_SEQ AND A.STD_YYMM - 1300 = B.STD_YYMM) RATE 
			 ,GNRL_AVG_PRC - (SELECT GNRL_AVG_PRC FROM KMIG_KB_CMPX_TYP_MON_PRC B WHERE A.CMPX_IDF_ID = B.CMPX_IDF_ID AND A.HOUSE_TYP_SEQ = B.HOUSE_TYP_SEQ AND A.STD_YYMM - 1300 = B.STD_YYMM) DIFF
             ,(SELECT GNRL_AVG_PRC - GNRL_JS_AVG_PRC FROM KMIG_KB_CMPX_TYP_MON_PRC B WHERE A.CMPX_IDF_ID = B.CMPX_IDF_ID AND A.HOUSE_TYP_SEQ = B.HOUSE_TYP_SEQ AND A.STD_YYMM - 1300 = B.STD_YYMM) INVEST
			 ,(GNRL_AVG_PRC - (SELECT GNRL_AVG_PRC FROM KMIG_KB_CMPX_TYP_MON_PRC B WHERE A.CMPX_IDF_ID = B.CMPX_IDF_ID AND A.HOUSE_TYP_SEQ = B.HOUSE_TYP_SEQ AND A.STD_YYMM - 1300 = B.STD_YYMM))/(SELECT GNRL_AVG_PRC - GNRL_JS_AVG_PRC FROM KMIG_KB_CMPX_TYP_MON_PRC B WHERE A.CMPX_IDF_ID = B.CMPX_IDF_ID AND A.HOUSE_TYP_SEQ = B.HOUSE_TYP_SEQ AND A.STD_YYMM - 1300 = B.STD_YYMM) INVEST_RATE
        FROM KMIG_KB_CMPX_TYP_MON_PRC A
		WHERE STD_YYMM = '201701'
		) T_DIFF
WHERE CT.CMPX_IDF_ID = T_DIFF.CMPX_IDF_ID
AND CT.HOUSE_TYP_SEQ = T_DIFF.HOUSE_TYP_SEQ
AND KC.CMPX_IDF_ID = CT.CMPX_IDF_ID
AND KC.KB_REGN_CD = KR3.KB_REGN_CD
AND KR3.UP_KB_REGN_CD = KR2.KB_REGN_CD
AND KR2.UP_KB_REGN_CD = KR1.KB_REGN_CD
AND KR1.KB_REGN_CD = '010000'
#AND T_DIFF.INVEST BETWEEN 10000 AND 20000
ORDER BY RATE DESC     
;


SELECT *
FROM KMIG_KB_REGN
;